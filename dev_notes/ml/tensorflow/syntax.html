<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tensorflow Syntax | Joe Lin</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.c36325bf.css" as="style"><link rel="preload" href="/assets/js/app.e04e06c7.js" as="script"><link rel="preload" href="/assets/js/7.0f4a11df.js" as="script"><link rel="prefetch" href="/assets/js/8.42ea1d9b.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.e47c214c.js"><link rel="prefetch" href="/assets/js/2.ca61bc24.js"><link rel="prefetch" href="/assets/js/3.7c27b296.js"><link rel="prefetch" href="/assets/js/4.61a94b53.js"><link rel="prefetch" href="/assets/js/5.9fd63af5.js"><link rel="prefetch" href="/assets/js/6.57f14f08.js"><link rel="prefetch" href="/assets/js/9.91201f3b.js"><link rel="prefetch" href="/assets/js/10.d18985b9.js"><link rel="prefetch" href="/assets/js/11.3950009d.js"><link rel="prefetch" href="/assets/js/12.44aeca04.js"><link rel="prefetch" href="/assets/js/13.6e946f62.js"><link rel="prefetch" href="/assets/js/14.a435ff09.js"><link rel="prefetch" href="/assets/js/15.da8d70ff.js"><link rel="prefetch" href="/assets/js/16.77bf496d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c36325bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Joe Lin
    </span></a><div class="links"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">DevNotes</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/dev_notes/chatbot/" class="nav-link">Chatbot</a></li><li class="dropdown-item"><!----><a href="/dev_notes/ml/" class="nav-link router-link-active">Machine Learning</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">DevNotes</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/dev_notes/chatbot/" class="nav-link">Chatbot</a></li><li class="dropdown-item"><!----><a href="/dev_notes/ml/" class="nav-link router-link-active">Machine Learning</a></li></ul></div></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Tensorflow</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/dev_notes/ml/tensorflow/common-networks.html" class="sidebar-link">Common Networks</a></li><li><a href="/dev_notes/ml/tensorflow/syntax.html" class="active sidebar-link">Tensorflow Syntax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#session" class="sidebar-link">Session</a></li><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#placeholder" class="sidebar-link">Placeholder</a></li><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#activation" class="sidebar-link">Activation</a></li><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#simple-regression" class="sidebar-link">Simple Regression</a></li><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#simple-classification" class="sidebar-link">Simple Classification</a></li><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#save-load-model" class="sidebar-link">Save / Load Model</a></li><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#tensorboard" class="sidebar-link">Tensorboard</a></li><li class="sidebar-sub-header"><a href="/dev_notes/ml/tensorflow/syntax.html#dataset" class="sidebar-link">Dataset</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Tools</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1>Tensorflow Syntax</h1><h2 id="session"><a href="#session" aria-hidden="true" class="header-anchor">#</a> Session</h2><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Method 1</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>dot_operation<span class="token punctuation">)</span>
sess<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Method 2</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    result <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>dot_operation<span class="token punctuation">)</span>
    <span class="token comment"># Run multiple ops</span>
    z1_value<span class="token punctuation">,</span> z2_value <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>z1<span class="token punctuation">,</span> z2<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="placeholder"><a href="#placeholder" aria-hidden="true" class="header-anchor">#</a> Placeholder</h2><div class="language-python line-numbers-mode"><pre class="language-python"><code>x1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
y1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
z1 <span class="token operator">=</span> x1 <span class="token operator">+</span> y1
x2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
z2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="activation"><a href="#activation" aria-hidden="true" class="header-anchor">#</a> Activation</h2><div class="language-python line-numbers-mode"><pre class="language-python"><code>x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>     <span class="token comment"># x data, shape=(100, 1)</span>
y_relu <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y_sigmoid <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y_tanh <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y_softplus <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>softplus<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y_softmax <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
y_relu<span class="token punctuation">,</span> y_sigmoid<span class="token punctuation">,</span> y_tanh<span class="token punctuation">,</span> y_softplus<span class="token punctuation">,</span> y_softmax <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>y_relu<span class="token punctuation">,</span> y_sigmoid<span class="token punctuation">,</span> y_tanh<span class="token punctuation">,</span> y_softplus<span class="token punctuation">,</span> y_softmax<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/images/activation-syntax.png" alt="activation-syntax.png"></p><h2 id="simple-regression"><a href="#simple-regression" aria-hidden="true" class="header-anchor">#</a> Simple Regression</h2><div class="language-python line-numbers-mode"><pre class="language-python"><code>tf_x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>     <span class="token comment"># input x</span>
tf_y <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>     <span class="token comment"># input y</span>

<span class="token comment"># one hidden fully connected layer</span>
l1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>tf_x<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">)</span>     <span class="token comment"># hidden layer</span>
output <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>l1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>                <span class="token comment"># output layer =&gt; output one float number</span>

loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>mean_squared_error<span class="token punctuation">(</span>tf_y<span class="token punctuation">,</span> output<span class="token punctuation">)</span>   <span class="token comment"># compute loss</span>
optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
train_op <span class="token operator">=</span> optimizer<span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># control training and others</span>
sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># initialize var in graph</span>

<span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># train and net output</span>
    _<span class="token punctuation">,</span> l<span class="token punctuation">,</span> pred <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>train_op<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> output<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>tf_x<span class="token punctuation">:</span> x<span class="token punctuation">,</span> tf_y<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment"># plot and show learning process</span>
    <span class="token keyword">if</span> step <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>cla<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># clear current axis (clear previous drawn line)</span>
        plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> pred<span class="token punctuation">,</span> <span class="token string">'r-'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Loss=%.4f'</span> <span class="token operator">%</span> l<span class="token punctuation">,</span> fontdict<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><img src="/images/simple_regression.png" alt="simple_regression.png"></p><h2 id="simple-classification"><a href="#simple-classification" aria-hidden="true" class="header-anchor">#</a> Simple Classification</h2><div class="language-python line-numbers-mode"><pre class="language-python"><code>tf_x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>   <span class="token comment"># input x</span>
tf_y <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>     <span class="token comment"># input y</span>

<span class="token comment"># neural network layers</span>
l1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>tf_x<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">)</span>          <span class="token comment"># hidden layer</span>
output <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>l1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                     <span class="token comment"># output layer</span>

<span class="token comment"># Use cross entropy to compute loss</span>
loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>sparse_softmax_cross_entropy<span class="token punctuation">(</span>labels<span class="token operator">=</span>tf_y<span class="token punctuation">,</span> logits<span class="token operator">=</span>output<span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">)</span>
train_op <span class="token operator">=</span> optimizer<span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

<span class="token comment"># Use accuracy to measure performance</span>
<span class="token comment"># return (acc, update_op), and creates 2 local variables</span>
accuracy <span class="token operator">=</span> tf<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span>accuracy<span class="token punctuation">(</span>  
    labels<span class="token operator">=</span>tf<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>tf_y<span class="token punctuation">)</span><span class="token punctuation">,</span> predictions<span class="token operator">=</span>tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>output<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># control training and others</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
init_op <span class="token operator">=</span> tf<span class="token punctuation">.</span>group<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   tf<span class="token punctuation">.</span>local_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init_op<span class="token punctuation">)</span>

<span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># train and net output</span>
    _<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> pred <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>train_op<span class="token punctuation">,</span> accuracy<span class="token punctuation">,</span> output<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>tf_x<span class="token punctuation">:</span> x<span class="token punctuation">,</span> tf_y<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment"># plot and show learning process</span>
    <span class="token keyword">if</span> step <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>cla<span class="token punctuation">(</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span>pred<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'RdYlGn'</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Accuracy=%.2f'</span> <span class="token operator">%</span> acc<span class="token punctuation">,</span> fontdict<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><img src="/images/simple_classification.png" alt="simple_classification.png"></p><hr><p><strong>softmax_cross_entropy</strong> vs. <strong>sparse_softmax_cross_entropy</strong></p><table><thead><tr><th></th><th><code>softmax_cross_entropy</code></th><th><code>sparse_softmax_cross_entropy</code></th></tr></thead><tbody><tr><td>Label Type</td><td>int32 / int64</td><td>float32 / float64</td></tr><tr><td>Label Shape</td><td>(batch_size, n_classes)</td><td>(batch_size)</td></tr><tr><td>Label Form</td><td>Any Integer</td><td>One-hot Encoding</td></tr></tbody></table><h2 id="save-load-model"><a href="#save-load-model" aria-hidden="true" class="header-anchor">#</a> Save / Load Model</h2><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># SAVE</span>
saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># sess.run ...</span>
<span class="token comment"># write_meta_graph is not recommended (can be very large)</span>
saver<span class="token punctuation">.</span>save<span class="token punctuation">(</span>sess<span class="token punctuation">,</span> <span class="token string">'./&lt;dir&gt;/&lt;file_prefix&gt;'</span><span class="token punctuation">,</span> write_meta_graph<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># LOAD</span>
saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span><span class="token punctuation">)</span>
saver<span class="token punctuation">.</span>restore<span class="token punctuation">(</span>sess<span class="token punctuation">,</span> <span class="token string">'./&lt;dir&gt;/&lt;file_prefix&gt;'</span><span class="token punctuation">)</span>
<span class="token comment"># sess.run ...</span>

sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'w1:0'</span><span class="token punctuation">)</span> <span class="token comment"># run specific operation</span>
w1 <span class="token operator">=</span> graph<span class="token punctuation">.</span>get_tensor_by_name<span class="token punctuation">(</span><span class="token string">'w1:0'</span><span class="token punctuation">)</span> <span class="token comment"># get original tensor/operation</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="tensorboard"><a href="#tensorboard" aria-hidden="true" class="header-anchor">#</a> Tensorboard</h2><p>Run tensorboard with <code>tensorboard --logdir path/to/logdir</code></p><div class="language-python line-numbers-mode"><pre class="language-python"><code>tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>histogram<span class="token punctuation">(</span><span class="token string">'pred'</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">'loss'</span><span class="token punctuation">,</span> loss<span class="token punctuation">)</span>     <span class="token comment"># add loss to scalar summary</span>
merge_op <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>merge_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./log'</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>     <span class="token comment"># write to file</span>

<span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># train and net output</span>
    _<span class="token punctuation">,</span> result <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>train_op<span class="token punctuation">,</span> merge_op<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>tf_x<span class="token punctuation">:</span> x<span class="token punctuation">,</span> tf_y<span class="token punctuation">:</span> y<span class="token punctuation">}</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>add_summary<span class="token punctuation">(</span>result<span class="token punctuation">,</span> step<span class="token punctuation">)</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="dataset"><a href="#dataset" aria-hidden="true" class="header-anchor">#</a> Dataset</h2><div class="language-python line-numbers-mode"><pre class="language-python"><code>tfx <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>npx_train<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> npx_train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
tfy <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>npy_train<span class="token punctuation">.</span>dtype<span class="token punctuation">,</span> npy_train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

dataset <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>tfx<span class="token punctuation">,</span> tfy<span class="token punctuation">)</span><span class="token punctuation">)</span>
dataset <span class="token operator">=</span> dataset<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>buffer_size<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
dataset <span class="token operator">=</span> dataset<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
dataset <span class="token operator">=</span> dataset<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># repeat epochs, if not specified, default is 1 epoch</span>
iterator <span class="token operator">=</span> dataset<span class="token punctuation">.</span>make_initializable_iterator<span class="token punctuation">(</span><span class="token punctuation">)</span>
bx<span class="token punctuation">,</span> by <span class="token operator">=</span> iterator<span class="token punctuation">.</span>get_next<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># returns get_next operation</span>
l1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>bx<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">)</span>
out <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>l1<span class="token punctuation">,</span> npy<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>mean_squared_error<span class="token punctuation">(</span>by<span class="token punctuation">,</span> out<span class="token punctuation">)</span>
train <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>iterator<span class="token punctuation">.</span>initializer<span class="token punctuation">,</span> tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>tfx<span class="token punctuation">:</span> npx_train<span class="token punctuation">,</span> tfy<span class="token punctuation">:</span> npy_train<span class="token punctuation">}</span><span class="token punctuation">)</span>

N <span class="token operator">=</span> <span class="token number">200</span>
<span class="token comment"># Iterate times: min(N, num_train / batch_size * epochs)</span>
<span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># data is embedded into `train`</span>
        _<span class="token punctuation">,</span> trainl <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>train<span class="token punctuation">,</span> loss<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> step <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># run loss op on test set</span>
            testl <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token punctuation">{</span>bx<span class="token punctuation">:</span> npx_test<span class="token punctuation">,</span> by<span class="token punctuation">:</span> npy_test<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment"># If N &gt; num_train / batch_size * epochs, this exception will be raised</span>
    <span class="token keyword">except</span> tf<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>OutOfRangeError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Finished the last epoch.'</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/dev_notes/ml/tensorflow/common-networks.html" class="prev">
          Common Networks
        </a></span><span class="next"><a href="/dev_notes/ml/tools/jupyter-colab.html">
          Jupyter Notebook on Google Colab
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/7.0f4a11df.js" defer></script><script src="/assets/js/app.e04e06c7.js" defer></script>
  </body>
</html>
